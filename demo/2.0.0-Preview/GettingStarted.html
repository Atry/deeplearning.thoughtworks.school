---
layout: demo
title: GettingStarted
download_path: demo_download/./2.0.0-Preview
filename: GettingStarted.ipynb
---
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this GettingStarted article, we will build a robot for answering questions in IQ test with the help of <a href="http://deeplearning.thoughtworks.school/">DeepLearning.scala</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Suppose we are building a robot for answering questions in IQ test like this:</p>
<blockquote><p>What is the next number in sequence:</p>
<blockquote><p>3, 6, 9, ?</p>
</blockquote>
<p>The answer is 12.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We prepared some questions and corresponding answers as <a href="https://oss.sonatype.org/service/local/repositories/public/archive/org/nd4j/nd4j-api/0.8.0/nd4j-api-0.8.0-javadoc.jar/!/org/nd4j/linalg/api/ndarray/INDArray.html">INDArray</a>s:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">$ivy.</span><span class="n">`org.nd4j::nd4s:0.8.0`</span><span class="o">,</span> <span class="nc">$ivy</span><span class="o">.</span><span class="n">`org.nd4j:nd4j-native-platform:0.8.0`</span>
<span class="k">import</span> <span class="nn">org.nd4j.linalg.api.ndarray.INDArray</span>

<span class="k">val</span> <span class="nc">TrainingQuestions</span><span class="k">:</span> <span class="kt">INDArray</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">org.nd4s.Implicits._</span>
  <span class="nc">Array</span><span class="o">(</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">10</span><span class="o">),</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">17</span><span class="o">)</span>
  <span class="o">).</span><span class="n">toNDArray</span>
<span class="o">}</span>

<span class="k">val</span> <span class="nc">ExpectedAnswers</span><span class="k">:</span> <span class="kt">INDArray</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">org.nd4s.Implicits._</span>
  <span class="nc">Array</span><span class="o">(</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">13</span><span class="o">),</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">19</span><span class="o">)</span>
  <span class="o">).</span><span class="n">toNDArray</span>
<span class="o">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>SLF4J: Failed to load class &#34;org.slf4j.impl.StaticLoggerBinder&#34;.
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt output_prompt">Out[1]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">$ivy.$                     , $ivy.$                                    
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">org.nd4j.linalg.api.ndarray.INDArray

</span>
<span class="ansi-cyan-fg">TrainingQuestions</span>: <span class="ansi-green-fg">org</span>.<span class="ansi-green-fg">nd4j</span>.<span class="ansi-green-fg">linalg</span>.<span class="ansi-green-fg">api</span>.<span class="ansi-green-fg">ndarray</span>.<span class="ansi-green-fg">INDArray</span> = [[0.00, 1.00, 2.00],
 [4.00, 7.00, 10.00],
 [13.00, 15.00, 17.00]]
<span class="ansi-cyan-fg">ExpectedAnswers</span>: <span class="ansi-green-fg">org</span>.<span class="ansi-green-fg">nd4j</span>.<span class="ansi-green-fg">linalg</span>.<span class="ansi-green-fg">api</span>.<span class="ansi-green-fg">ndarray</span>.<span class="ansi-green-fg">INDArray</span> = [3.00, 13.00, 19.00]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These samples will be used to train the robot.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the rest of this article, we will build the robot in the following steps:</p>
<ol>
<li>Install DeepLearning.scala, which is the framework that helps us build the robot.</li>
<li>Setup configuration (also known as hyperparameters) of the robot.</li>
<li>Build an untrained neural network of the robot.</li>
<li>Train the neural network using the above samples.</li>
<li>Test the robot seeing if the robot have been learnt how to answer these kind of questions.</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install-DeepLearning.scala">Install DeepLearning.scala<a class="anchor-link" href="#Install-DeepLearning.scala">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>DeepLearning.scala is hosted on Maven Central repository.</p>
<p>You can use magic imports in <a href="https://github.com/alexarchambault/jupyter-scala">jupyter-scala</a> or <a href="http://www.lihaoyi.com/Ammonite/#Ammonite-REPL">Ammonite-REPL</a> to download DeepLearning.scala and its dependencies.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">$ivy.</span><span class="n">`com.thoughtworks.deeplearning::plugins-builtins:2.0.0-RC1`</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[2]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">$ivy.$                                                          </span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you use <a href="http://www.scala-sbt.org">sbt</a>, please add the following settings into your <code>build.sbt</code>:</p>
<div class="highlight"><pre><span></span><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;com.thoughtworks.deeplearning&quot;</span> <span class="o">%%</span> <span class="s">&quot;plugins-builtins&quot;</span> <span class="o">%</span> <span class="s">&quot;latest.release&quot;</span>

<span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;org.nd4j&quot;</span> <span class="o">%%</span> <span class="s">&quot;nd4j-native-platform&quot;</span> <span class="o">%</span> <span class="s">&quot;0.8.0&quot;</span>

<span class="n">fork</span> <span class="o">:=</span> <span class="kc">true</span>

<span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">&quot;2.11.11&quot;</span>
</pre></div>
<p>Note that this example must run on Scala 2.11.11 because <a href="http://nd4j.org/scala">nd4s</a> does not support Scala 2.12. Make sure there is not a setting like <code>scalaVersion := "2.12.x"</code> in your <code>build.sbt</code>.</p>
<p>See <a href="https://index.scala-lang.org/thoughtworksinc/deeplearning.scala">Scaladex</a> to install DeepLearning.scala in other build tools!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup-hyperparameters">Setup hyperparameters<a class="anchor-link" href="#Setup-hyperparameters">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Hyperparameters are global configurations for a neural network.</p>
<p>For this robot, we want to set its learning rate, which determines how fast the robot change its inner weights.</p>
<p>In DeepLearning.scala, hyperparameters can be introduced by plugins, which is a small piece of code loaded from a URL.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">val</span> <span class="nc">INDArrayLearningRatePluginUrl</span> <span class="k">=</span> <span class="s">&quot;https://gist.githubusercontent.com/Atry/1fb0608c655e3233e68b27ba99515f16/raw/27c7d00dd37785335b6acfe1f1c5614843bc6d9f/INDArrayLearningRate.sc&quot;</span>
<span class="n">interp</span><span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="n">scala</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">Source</span><span class="o">.</span><span class="n">fromURL</span><span class="o">(</span><span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="nc">URL</span><span class="o">(</span><span class="nc">INDArrayLearningRatePluginUrl</span><span class="o">)).</span><span class="n">mkString</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">INDArrayLearningRatePluginUrl</span>: <span class="ansi-green-fg">String</span> = <span class="ansi-green-fg">&#34;https://gist.githubusercontent.com/Atry/1fb0608c655e3233e68b27ba99515f16/raw/27c7d00dd37785335b6acfe1f1c5614843bc6d9f/INDArrayLearningRate.sc&#34;</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>By loading the hyperparameter plugin <code>INDArrayLearningRate</code>, we are able to create the context of neural network with <code>learningRate</code> parameter.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">com.thoughtworks.deeplearning.plugins.Builtins</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">com.thoughtworks.deeplearning.plugins.Builtins</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All DeepLearning.scala built-in features are also provided by plugins. <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/plugins/Builtins.html">Builtins</a> is the plugin that contains all other DeepLearning.scala built-in plugins.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we create the context and setup learning rate to <code>0.001</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="c1">// `interp.load` is a workaround for https://github.com/lihaoyi/Ammonite/issues/649 and https://github.com/scala/bug/issues/10390</span>
<span class="n">interp</span><span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">  import scala.concurrent.ExecutionContext.Implicits.global</span>
<span class="s">  import com.thoughtworks.feature.Factory</span>
<span class="s">  val hyperparameters = Factory[Builtins with INDArrayLearningRate].newInstance(learningRate = 0.001)</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>See <a href="https://javadoc.io/page/com.thoughtworks.feature/factory_2.11/latest/com/thoughtworks/feature/Factory.html">Factory</a> if you are wondering how those plugins are composed together.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>Builtins</code> plugin contains some implicit values and views, which should be imported as following:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">hyperparameters.implicits._</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">hyperparameters.implicits._</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Build-an-untrained-neural-network-of-the-robot">Build an untrained neural network of the robot<a class="anchor-link" href="#Build-an-untrained-neural-network-of-the-robot">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In DeepLearning.scala, a neural network is simply a function that references some <strong>weights</strong>, which are mutable variables being changed automatically according to some goals during training.</p>
<p>For example, given <code>x0</code>, <code>x1</code> and <code>x2</code> are the input sequence passed to the robot, we can build a function that returns the answer as <code>robotWeight0 * x0 + robotWeight1 * x1 + robotWeight2 * x2</code>, by adjusting those weightsduring training, the result should become close to the expected answer.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In DeepLearning.scala, weights can be created as following:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">def</span> <span class="n">initialValueOfRobotWeight</span><span class="k">:</span> <span class="kt">INDArray</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">org.nd4j.linalg.factory.Nd4j</span>
  <span class="k">import</span> <span class="nn">org.nd4s.Implicits._</span>
  <span class="nc">Nd4j</span><span class="o">.</span><span class="n">randn</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">import</span> <span class="nn">hyperparameters.INDArrayWeight</span>
<span class="k">val</span> <span class="n">robotWeight</span> <span class="k">=</span> <span class="nc">INDArrayWeight</span><span class="o">(</span><span class="n">initialValueOfRobotWeight</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>defined <span class="ansi-green-fg">function</span> <span class="ansi-cyan-fg">initialValueOfRobotWeight</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">hyperparameters.INDArrayWeight
</span>
<span class="ansi-cyan-fg">robotWeight</span>: <span class="ansi-green-fg">Object</span> with <span class="ansi-green-fg">hyperparameters</span>.<span class="ansi-green-fg">INDArrayWeightApi</span> with <span class="ansi-green-fg">hyperparameters</span>.<span class="ansi-green-fg">WeightApi</span> with <span class="ansi-green-fg">hyperparameters</span>.<span class="ansi-green-fg">WeightApi</span> = $sess.cmd6Wrapper$Helper$Anonymous$macro$1$1$Anonymous$macro$121$1@4901b8d</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the above code, <code>robotWeight</code> is a weight of n-dimensional array, say, <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/plugins/INDArrayWeights$INDArrayWeight.html">INDArrayWeight</a>, initialized from random values. Therefore, the formula <code>robotWeight0 * x0 + robotWeight1 * x1 + robotWeight2 * x2</code> can be equivalent to a matrix multipication, written as a <code>dot</code> method call:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">hyperparameters.INDArrayLayer</span>
<span class="k">def</span> <span class="n">iqTestRobot</span><span class="o">(</span><span class="n">questions</span><span class="k">:</span> <span class="kt">INDArray</span><span class="o">)</span><span class="k">:</span> <span class="kt">INDArrayLayer</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">questions</span> <span class="n">dot</span> <span class="n">robotWeight</span>
<span class="o">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">hyperparameters.INDArrayLayer
</span>
defined <span class="ansi-green-fg">function</span> <span class="ansi-cyan-fg">iqTestRobot</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that the <code>dot</code> method is a differentiable function provided by DeepLearning.scala.
You can find other <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/plugins/RawINDArrayLayers$ImplicitsApi$INDArrayLayerOps.html">n-dimensional array differentiable methods in Scaladoc</a></p>
<p>Unlike the functions in nd4s, all those differentiable functions accepts either an <code>INDArray</code>, <code>INDArrayWeight</code> 
or <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/plugins/RawINDArrayLayers$INDArrayLayer.html">INDArrayLayer</a>, and returns one <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/plugins/Layers$Layer.html">Layer</a> of neural network, which can be composed into another differentiable function call.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Training-the-network">Training the network<a class="anchor-link" href="#Training-the-network">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Loss-function">Loss function<a class="anchor-link" href="#Loss-function">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In DeepLearning.scala, when we train a neural network, our goal should always be minimizing the return value.</p>
<p>For example, if <code>iqTestRobot(TrainingQuestions).train</code> get called repeatedly,
the neural network would try to minimize <code>input dot robotWeight</code>.
<code>robotWeight</code> would become smaller and smaller in order to make <code>input dot robotWeight</code> smaller,
and <code>iqTestRobot(TrainingQuestions).predict</code> would return an <code>INDArray</code> of small numbers.</p>
<p>What if you expect <code>iqTestRobot(TrainingQuestions).predict</code> to return <code>ExpectedAnswers</code>?</p>
<p>You can create another neural network that evaluates how far between the result of <code>myNeuralNetwork</code> and your expectation. The new neural network is usually called <strong>loss function</strong>.</p>
<p>In this article we will use square loss as the loss function:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">hyperparameters.DoubleLayer</span>
<span class="k">def</span> <span class="n">squareLoss</span><span class="o">(</span><span class="n">questions</span><span class="k">:</span> <span class="kt">INDArray</span><span class="o">,</span> <span class="n">expectAnswer</span><span class="k">:</span> <span class="kt">INDArray</span><span class="o">)</span><span class="k">:</span> <span class="kt">DoubleLayer</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">difference</span> <span class="k">=</span> <span class="n">iqTestRobot</span><span class="o">(</span><span class="n">questions</span><span class="o">)</span> <span class="o">-</span> <span class="n">expectAnswer</span>
  <span class="o">(</span><span class="n">difference</span> <span class="o">*</span> <span class="n">difference</span><span class="o">).</span><span class="n">sum</span>
<span class="o">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">hyperparameters.DoubleLayer
</span>
defined <span class="ansi-green-fg">function</span> <span class="ansi-cyan-fg">squareLoss</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When the <code>lossFunction</code> get trained continuously, its return value will be close to zero, and the result of  <code>myNeuralNetwork</code> must be close to the expected result at the same time.</p>
<p>Note the <code>lossFunction</code> accepts a <code>questions</code> and <code>expectAnswer</code> as its parameter.
The first parameter is the input data used to train the neural network, and the second array is the expected output.</p>
<p>The <code>squareLoss</code> function itself is a neural network, internally using the layer returned by <code>iqTestRobot</code> method.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Run-the-training-task">Run the training task<a class="anchor-link" href="#Run-the-training-task">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As I mentioned before, there is a <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/DeepLearning$$Ops.html#train(implicitmonoid:spire.algebra.MultiplicativeMonoid[Ops.this.typeClassInstance.Delta]):scalaz.concurrent.Task[Ops.this.typeClassInstance.Data]">train</a> method for <code>DoubleLayer</code>. It is a <a href="https://javadoc.io/page/org.scalaz/scalaz-concurrent_2.11/latest/scalaz/concurrent/Task.html">Task</a> that performs one iteration of training.</p>
<p>Since we want to repeatedly train the neural network of the robot, we need to create another <code>Task</code> that performs many iterations of training.</p>
<p>In this article, we use <a href="https://github.com/ThoughtWorksInc/each">ThoughtWorks Each</a> to build such a <code>Task</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">$ivy.</span><span class="n">`com.thoughtworks.each::each:3.3.1`</span>
<span class="k">import</span> <span class="nn">$plugin.$ivy.</span><span class="n">`org.scalamacros:paradise_2.11.11:2.1.0`</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">$ivy.$                                  
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">$plugin.$                                            </span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">com.thoughtworks.each.Monadic._</span>
<span class="k">import</span> <span class="nn">scalaz.concurrent.Task</span>
<span class="k">import</span> <span class="nn">scalaz.std.stream._</span>

<span class="k">val</span> <span class="nc">TotalIterations</span> <span class="k">=</span> <span class="mi">500</span>

<span class="nd">@monadic</span><span class="o">[</span><span class="kt">Task</span><span class="o">]</span>
<span class="k">def</span> <span class="n">train</span><span class="k">:</span> <span class="kt">Task</span><span class="o">[</span><span class="kt">Stream</span><span class="o">[</span><span class="kt">Double</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">iteration</span> <span class="k">&lt;-</span> <span class="o">(</span><span class="mi">0</span> <span class="n">until</span> <span class="nc">TotalIterations</span><span class="o">).</span><span class="n">toStream</span><span class="o">)</span> <span class="k">yield</span> <span class="o">{</span>
    <span class="n">squareLoss</span><span class="o">(</span><span class="nc">TrainingQuestions</span><span class="o">,</span> <span class="nc">ExpectedAnswers</span><span class="o">).</span><span class="n">train</span><span class="o">.</span><span class="n">each</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">com.thoughtworks.each.Monadic._
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">scalaz.concurrent.Task
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">scalaz.std.stream._

</span>
<span class="ansi-cyan-fg">TotalIterations</span>: <span class="ansi-green-fg">Int</span> = <span class="ansi-green-fg">500</span>
defined <span class="ansi-green-fg">function</span> <span class="ansi-cyan-fg">train</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we can run the task to train the robot.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">val</span> <span class="n">lossByTime</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="n">train</span><span class="o">.</span><span class="n">unsafePerformSync</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[14]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">lossByTime</span>: <span class="ansi-green-fg">Stream</span>[<span class="ansi-green-fg">Double</span>] = <span class="ansi-yellow-fg">Stream</span>(
  <span class="ansi-green-fg">3170.14697265625</span>,
  <span class="ansi-green-fg">1514.948974609375</span>,
  <span class="ansi-green-fg">727.3214721679688</span>,
  <span class="ansi-green-fg">352.4190673828125</span>,
  <span class="ansi-green-fg">173.86407470703125</span>,
  <span class="ansi-green-fg">88.72171020507812</span>,
  <span class="ansi-green-fg">48.02387619018555</span>,
  <span class="ansi-green-fg">28.475372314453125</span>,
  <span class="ansi-green-fg">18.994029998779297</span>,
  <span class="ansi-green-fg">14.307679176330566</span>,
  <span class="ansi-green-fg">11.908065795898438</span>,
<span class="ansi-yellow-fg">...</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we create a plot to show how the loss changed during iterations.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">$ivy.</span><span class="n">`org.plotly-scala::plotly-jupyter-scala:0.3.2`</span>

<span class="k">import</span> <span class="nn">plotly._</span>
<span class="k">import</span> <span class="nn">plotly.element._</span>
<span class="k">import</span> <span class="nn">plotly.layout._</span>
<span class="k">import</span> <span class="nn">plotly.JupyterScala._</span>

<span class="n">plotly</span><span class="o">.</span><span class="nc">JupyterScala</span><span class="o">.</span><span class="n">init</span><span class="o">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">

      <script type="text/javascript">
        require.config({
  paths: {
    d3: 'https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min',
    plotly: 'https://cdn.plot.ly/plotly-1.12.0.min'
  },

  shim: {
    plotly: {
      deps: ['d3', 'jquery'],
      exports: 'plotly'
    }
  }
});
        

        require(['plotly'], function(Plotly) {
          window.Plotly = Plotly;
        });
      </script>
    
</div>

</div>

<div class="output_area">

<div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">$ivy.$                                             

</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">plotly._
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">plotly.element._
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">plotly.layout._
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">plotly.JupyterScala._

</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="nc">Scatter</span><span class="o">(</span><span class="n">lossByTime</span><span class="o">.</span><span class="n">indices</span><span class="o">,</span> <span class="n">lossByTime</span><span class="o">).</span><span class="n">plot</span><span class="o">(</span><span class="n">title</span> <span class="k">=</span> <span class="s">&quot;loss by time&quot;</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div class="chart" id="plot-1545764927"></div>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>





<div id="865e97cf-06c6-4288-97c3-858056e94f44"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#865e97cf-06c6-4288-97c3-858056e94f44');
requirejs(["plotly"], function(Plotly) {
  (function () {
  var data0 = {"type":"scatter","x":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0,20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0,52.0,53.0,54.0,55.0,56.0,57.0,58.0,59.0,60.0,61.0,62.0,63.0,64.0,65.0,66.0,67.0,68.0,69.0,70.0,71.0,72.0,73.0,74.0,75.0,76.0,77.0,78.0,79.0,80.0,81.0,82.0,83.0,84.0,85.0,86.0,87.0,88.0,89.0,90.0,91.0,92.0,93.0,94.0,95.0,96.0,97.0,98.0,99.0,100.0,101.0,102.0,103.0,104.0,105.0,106.0,107.0,108.0,109.0,110.0,111.0,112.0,113.0,114.0,115.0,116.0,117.0,118.0,119.0,120.0,121.0,122.0,123.0,124.0,125.0,126.0,127.0,128.0,129.0,130.0,131.0,132.0,133.0,134.0,135.0,136.0,137.0,138.0,139.0,140.0,141.0,142.0,143.0,144.0,145.0,146.0,147.0,148.0,149.0,150.0,151.0,152.0,153.0,154.0,155.0,156.0,157.0,158.0,159.0,160.0,161.0,162.0,163.0,164.0,165.0,166.0,167.0,168.0,169.0,170.0,171.0,172.0,173.0,174.0,175.0,176.0,177.0,178.0,179.0,180.0,181.0,182.0,183.0,184.0,185.0,186.0,187.0,188.0,189.0,190.0,191.0,192.0,193.0,194.0,195.0,196.0,197.0,198.0,199.0,200.0,201.0,202.0,203.0,204.0,205.0,206.0,207.0,208.0,209.0,210.0,211.0,212.0,213.0,214.0,215.0,216.0,217.0,218.0,219.0,220.0,221.0,222.0,223.0,224.0,225.0,226.0,227.0,228.0,229.0,230.0,231.0,232.0,233.0,234.0,235.0,236.0,237.0,238.0,239.0,240.0,241.0,242.0,243.0,244.0,245.0,246.0,247.0,248.0,249.0,250.0,251.0,252.0,253.0,254.0,255.0,256.0,257.0,258.0,259.0,260.0,261.0,262.0,263.0,264.0,265.0,266.0,267.0,268.0,269.0,270.0,271.0,272.0,273.0,274.0,275.0,276.0,277.0,278.0,279.0,280.0,281.0,282.0,283.0,284.0,285.0,286.0,287.0,288.0,289.0,290.0,291.0,292.0,293.0,294.0,295.0,296.0,297.0,298.0,299.0,300.0,301.0,302.0,303.0,304.0,305.0,306.0,307.0,308.0,309.0,310.0,311.0,312.0,313.0,314.0,315.0,316.0,317.0,318.0,319.0,320.0,321.0,322.0,323.0,324.0,325.0,326.0,327.0,328.0,329.0,330.0,331.0,332.0,333.0,334.0,335.0,336.0,337.0,338.0,339.0,340.0,341.0,342.0,343.0,344.0,345.0,346.0,347.0,348.0,349.0,350.0,351.0,352.0,353.0,354.0,355.0,356.0,357.0,358.0,359.0,360.0,361.0,362.0,363.0,364.0,365.0,366.0,367.0,368.0,369.0,370.0,371.0,372.0,373.0,374.0,375.0,376.0,377.0,378.0,379.0,380.0,381.0,382.0,383.0,384.0,385.0,386.0,387.0,388.0,389.0,390.0,391.0,392.0,393.0,394.0,395.0,396.0,397.0,398.0,399.0,400.0,401.0,402.0,403.0,404.0,405.0,406.0,407.0,408.0,409.0,410.0,411.0,412.0,413.0,414.0,415.0,416.0,417.0,418.0,419.0,420.0,421.0,422.0,423.0,424.0,425.0,426.0,427.0,428.0,429.0,430.0,431.0,432.0,433.0,434.0,435.0,436.0,437.0,438.0,439.0,440.0,441.0,442.0,443.0,444.0,445.0,446.0,447.0,448.0,449.0,450.0,451.0,452.0,453.0,454.0,455.0,456.0,457.0,458.0,459.0,460.0,461.0,462.0,463.0,464.0,465.0,466.0,467.0,468.0,469.0,470.0,471.0,472.0,473.0,474.0,475.0,476.0,477.0,478.0,479.0,480.0,481.0,482.0,483.0,484.0,485.0,486.0,487.0,488.0,489.0,490.0,491.0,492.0,493.0,494.0,495.0,496.0,497.0,498.0,499.0],"y":[3170.14697265625,1514.948974609375,727.3214721679688,352.4190673828125,173.86407470703125,88.72171020507812,48.02387619018555,28.475372314453125,18.994029998779297,14.307679176330566,11.908065795898438,10.601799011230469,9.820972442626953,9.295259475708008,8.895885467529297,8.561433792114258,8.262529373168945,7.985052108764648,7.722136497497559,7.470373153686523,7.228005886077881,6.994071960449219,6.767974853515625,6.549322128295898,6.33778190612793,6.13311767578125,5.935063362121582,5.7434186935424805,5.557966232299805,5.378498077392578,5.2048258781433105,5.036767959594727,4.874133586883545,4.7167487144470215,4.564444541931152,4.417065620422363,4.274438858032227,4.136417865753174,4.002852439880371,3.873608112335205,3.7485270500183105,3.627490758895874,3.5103600025177,3.397012710571289,3.2873268127441406,3.1811811923980713,3.078465461730957,2.9790596961975098,2.8828649520874023,2.7897815704345703,2.6996984481811523,2.612527847290039,2.5281713008880615,2.446533679962158,2.3675384521484375,2.2910914421081543,2.217113494873047,2.1455252170562744,2.076249361038208,2.009204387664795,1.944328784942627,1.8815479278564453,1.8207948207855225,1.7620010375976562,1.705108404159546,1.6500473022460938,1.59676992893219,1.5452120304107666,1.4953163862228394,1.4470348358154297,1.4003130197525024,1.3550939559936523,1.3113398551940918,1.2689967155456543,1.228020191192627,1.1883710622787476,1.1499974727630615,1.1128648519515991,1.0769317150115967,1.0421556234359741,1.0085042715072632,0.9759423732757568,0.9444284439086914,0.9139325022697449,0.884424090385437,0.8558660745620728,0.8282316327095032,0.801486611366272,0.7756072282791138,0.7505661249160767,0.7263293266296387,0.7028748989105225,0.6801804304122925,0.6582187414169312,0.6369633674621582,0.6163964867591858,0.5964941382408142,0.5772334337234497,0.5585944056510925,0.5405573844909668,0.5231030583381653,0.5062124133110046,0.48986688256263733,0.47404956817626953,0.458743155002594,0.44392964243888855,0.4295964241027832,0.41572508215904236,0.4023016095161438,0.3893098831176758,0.3767404854297638,0.3645753562450409,0.3528027832508087,0.3414122462272644,0.33038729429244995,0.3197203576564789,0.309395432472229,0.2994053065776825,0.2897373139858246,0.28038233518600464,0.27132898569107056,0.2625679671764374,0.25409018993377686,0.24588531255722046,0.237945556640625,0.2302626669406891,0.2228284627199173,0.2156330794095993,0.20867018401622772,0.2019326388835907,0.19541165232658386,0.1891019642353058,0.18299587070941925,0.177087664604187,0.17136959731578827,0.16583611071109772,0.16048124432563782,0.1552993208169937,0.15028506517410278,0.14543196558952332,0.14073701202869415,0.1361926943063736,0.13179445266723633,0.12753872573375702,0.12342120707035065,0.1194346696138382,0.11557865142822266,0.11184711009263992,0.10823538899421692,0.10474073886871338,0.10135845839977264,0.09808526188135147,0.09491881728172302,0.09185400605201721,0.0888877660036087,0.08601804077625275,0.08323957771062851,0.08055278658866882,0.0779513567686081,0.07543477416038513,0.0729992538690567,0.07064174115657806,0.06836078315973282,0.06615278124809265,0.06401737779378891,0.061950087547302246,0.059949781745672226,0.058014173060655594,0.05614067614078522,0.05432823672890663,0.05257370322942734,0.05087602883577347,0.049233369529247284,0.04764333739876747,0.0461055189371109,0.04461664333939552,0.04317609593272209,0.041781648993492126,0.040432512760162354,0.03912709280848503,0.03786379471421242,0.03664111718535423,0.03545746952295303,0.03431336581707001,0.033205412328243256,0.032133009284734726,0.031095262616872787,0.030091505497694016,0.0291198268532753,0.028179123997688293,0.027269437909126282,0.026389148086309433,0.025536715984344482,0.02471228875219822,0.023914281278848648,0.02314234897494316,0.022395119071006775,0.021671656519174576,0.020972082391381264,0.02029488980770111,0.019639525562524796,0.019005579873919487,0.01839168556034565,0.01779778115451336,0.017223112285137177,0.016667203977704048,0.016128942370414734,0.015608120709657669,0.015104231424629688,0.014616532251238823,0.014144551008939743,0.013687747530639172,0.013245680369436741,0.01281801052391529,0.012404017150402069,0.012003668583929539,0.011615954339504242,0.011240903288125992,0.010877804830670357,0.010526910424232483,0.010186759755015373,0.009857852011919022,0.009539589285850525,0.009231562726199627,0.008933346718549728,0.008645168505609035,0.008365855552256107,0.00809575617313385,0.00783452671021223,0.007581494748592377,0.007336611859500408,0.007099909242242575,0.0068705421872437,0.006648433394730091,0.006433940026909113,0.0062260935083031654,0.00602509081363678,0.005830633454024792,0.005642336793243885,0.00546012120321393,0.005283864680677652,0.005113320425152779,0.0049481564201414585,0.0047883205115795135,0.004633617587387562,0.004484256263822317,0.004339373670518398,0.004199249669909477,0.004063582047820091,0.003932339139282703,0.003805525368079543,0.0036825169809162617,0.0035636185202747583,0.0034487112425267696,0.003337241243571043,0.0032294816337525845,0.0031251644250005484,0.0030242791399359703,0.0029265754856169224,0.002832131925970316,0.002740714931860566,0.002652144292369485,0.0025664418935775757,0.0024836761876940727,0.0024034855887293816,0.0023259473964571953,0.002250752644613385,0.0021781621035188437,0.0021078053396195173,0.0020396218169480562,0.0019739139825105667,0.0019101968500763178,0.001848488813266158,0.0017887501744553447,0.001731051946990192,0.0016750876093283296,0.0016209951136261225,0.001568665960803628,0.0015179478796198964,0.0014689649688079953,0.001421555527485907,0.00137568567879498,0.0013312523951753974,0.0012882142327725887,0.0012466637417674065,0.0012064391048625112,0.00116745475679636,0.0011297387536615133,0.001093191560357809,0.0010579096851870418,0.0010238377144560218,9.90755157545209E-4,9.587844251655042E-4,9.277991484850645E-4,8.978673140518367E-4,8.68826755322516E-4,8.407832938246429E-4,8.136351825669408E-4,7.873519789427519E-4,7.619522511959076E-4,7.373273838311434E-4,7.135063060559332E-4,6.905081681907177E-4,6.68184831738472E-4,6.466033519245684E-4,6.257827044464648E-4,6.055448902770877E-4,5.860377568751574E-4,5.670782993547618E-4,5.487370071932673E-4,5.310314008966088E-4,5.138380220159888E-4,4.972494207322598E-4,4.8121862346306443E-4,4.656855307985097E-4,4.506519471760839E-4,4.360951134003699E-4,4.2201142059639096E-4,4.0841297595761716E-4,3.9516377728432417E-4,3.82472324417904E-4,3.700806410051882E-4,3.5819204640574753E-4,3.465836343821138E-4,3.3542272285558283E-4,3.2453457242809236E-4,3.140707267448306E-4,3.039683506358415E-4,2.941402781289071E-4,2.84625799395144E-4,2.7542401221580803E-4,2.665469946805388E-4,2.5791669031605124E-4,2.496209053788334E-4,2.4158092855941504E-4,2.337629848625511E-4,2.2623658878728747E-4,2.1889516210649163E-4,2.1183057106100023E-4,2.050138427875936E-4,1.9836919091176242E-4,1.9197972142137587E-4,1.8577376613393426E-4,1.7977003881242126E-4,1.7396340263076127E-4,1.6834665439091623E-4,1.6289680206682533E-4,1.5764839190524071E-4,1.525551051599905E-4,1.4765745436307043E-4,1.428680552635342E-4,1.382797781843692E-4,1.3377884170040488E-4,1.294683024752885E-4,1.2529612286016345E-4,1.212340866914019E-4,1.1731649283319712E-4,1.1354155139997602E-4,1.0988640133291483E-4,1.0631750774336979E-4,1.029083869070746E-4,9.95662048808299E-5,9.634751768317074E-5,9.325148857897148E-5,9.0243891463615E-5,8.732052810955793E-5,8.451164467260242E-5,8.177015843102708E-5,7.910655403975397E-5,7.659097173018381E-5,7.41075782570988E-5,7.169885793700814E-5,6.938850856386125E-5,6.716038478771225E-5,6.498571019619703E-5,6.288978329394013E-5,6.085831773816608E-5,5.888987288926728E-5,5.6980530644068494E-5,5.515489829122089E-5,5.336358299246058E-5,5.164120375411585E-5,4.997218638891354E-5,4.835694926441647E-5,4.6804914745735005E-5,4.528070712694898E-5,4.382786573842168E-5,4.240201087668538E-5,4.104354593437165E-5,3.971119804191403E-5,3.843202648567967E-5,3.719814048963599E-5,3.599558840505779E-5,3.483337059151381E-5,3.371226921444759E-5,3.261168239987455E-5,3.1567778933094814E-5,3.054469561902806E-5,2.9547263693530113E-5,2.8603968530660495E-5,2.7677313482854515E-5,2.6785573936649598E-5,2.5934421501006E-5,2.508206307538785E-5,2.42782843997702E-5,2.348942871321924E-5,2.272960773552768E-5,2.200679955421947E-5,2.1282789020915516E-5,2.0601362848537974E-5,1.993327896343544E-5,1.929039899550844E-5,1.866749516921118E-5,1.806274667615071E-5,1.7482268958701752E-5,1.691282886895351E-5,1.6366389900213107E-5,1.5831195923965424E-5,1.5330184396589175E-5,1.4839431969448924E-5,1.4363002264872193E-5,1.3883969586458988E-5,1.3442890121950768E-5,1.3010299880988896E-5,1.2596918168128468E-5,1.218047873408068E-5,1.1787669791374356E-5,1.1407825695641804E-5,1.1034831004508305E-5,1.0684500011848286E-5,1.0336039849789813E-5,1.0003780516854022E-5,9.6831508926698E-6,9.367744496557862E-6,9.063756806426682E-6,8.774351954343729E-6,8.495641850458924E-6,8.216977221309207E-6,7.94804327597376E-6,7.697559340158477E-6,7.44312274036929E-6,7.205813744803891E-6,6.977605607971782E-6,6.749691237928346E-6,6.5334970713593066E-6,6.317391125776339E-6,6.1180016928119585E-6,5.921503543504514E-6,5.725096343667246E-6,5.5434184105251916E-6,5.369141035771463E-6,5.19468176207738E-6,5.022810455557192E-6,4.861662091570906E-6,4.702998012362514E-6,4.554672159429174E-6,4.405858817335684E-6,4.262725269654766E-6,4.1257480916101485E-6,3.991008270531893E-6,3.86510873795487E-6,3.7359668567660265E-6,3.617363290686626E-6,3.501990249787923E-6,3.384921228644089E-6,3.2795298920973437E-6,3.1756990210851654E-6,3.0734299798496068E-6,2.970808964164462E-6,2.8755177936545806E-6,2.7795197183877463E-6,2.6926563805318438E-6,2.6051902750623412E-6,2.5240933609893546E-6,2.439739091641968E-6,2.3616667021997273E-6,2.285434675286524E-6,2.212581421190407E-6,2.138916897820309E-6,2.068999492621515E-6,2.0070219761691988E-6,1.937685283337487E-6,1.8757618818199262E-6,1.8173750504502095E-6,1.7579163795744535E-6,1.6997037164401263E-6,1.6445442270196509E-6,1.5942196114338003E-6,1.5410514606628567E-6,1.4925603863957804E-6,1.4433712749450933E-6,1.396919287799392E-6,1.353266497972072E-6,1.3079957170702983E-6,1.264212414753274E-6,1.2262646578165004E-6,1.1857812296511838E-6,1.1458319022494834E-6,1.1102602002210915E-6,1.075097543434822E-6]};

  var data = [data0];
  var layout = {"title":"loss by time"};

  Plotly.plot('plot-1545764927', data, layout);
})();
});
      
</script>
</div>

</div>

<div class="output_area">

<div class="prompt output_prompt">Out[16]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">res15</span>: <span class="ansi-green-fg">String</span> = <span class="ansi-green-fg">&#34;plot-1545764927&#34;</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>After these iterations, the loss should be close to zero.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test-the-trained-robot">Test the trained robot<a class="anchor-link" href="#Test-the-trained-robot">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">val</span> <span class="nc">TestQuestions</span><span class="k">:</span> <span class="kt">INDArray</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">org.nd4s.Implicits._</span>
  <span class="nc">Array</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">9</span><span class="o">)).</span><span class="n">toNDArray</span>
<span class="o">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">TestQuestions</span>: <span class="ansi-green-fg">INDArray</span> = [3.00, 6.00, 9.00]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="n">iqTestRobot</span><span class="o">(</span><span class="nc">TestQuestions</span><span class="o">).</span><span class="n">predict</span><span class="o">.</span><span class="n">unsafePerformSync</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[18]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">res17</span>: <span class="ansi-green-fg">INDArray</span> = 12.00</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The result should be close to <code>12</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You may also see the value of weights in the trained neural network:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">val</span> <span class="n">weightData</span><span class="k">:</span> <span class="kt">INDArray</span> <span class="o">=</span> <span class="n">robotWeight</span><span class="o">.</span><span class="n">data</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[19]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">weightData</span>: <span class="ansi-green-fg">INDArray</span> = [-0.43, -0.13, 1.57]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Conclusion">Conclusion<a class="anchor-link" href="#Conclusion">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this article, we have created a IQ test robot with the help of DeepLearning.scala.</p>
<p>The model of robot is linear regression with a square loss, which consists of some <code>INDArryWeight</code>s and <code>INDArrayLayer</code>s.</p>
<p>After many iterations of <code>train</code>ing, the robot finally learnt the pattern of arithmetic progression.</p>

</div>
</div>
</div>
 

