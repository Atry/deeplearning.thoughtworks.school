---
layout: demo
title: GettingStarted
download_path: demo_download/./2.0.0-Preview
filename: GettingStarted.ipynb
---
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this GettingStarted article, we will build a robot for answering questions in IQ test with the help of <a href="http://deeplearning.thoughtworks.school/">DeepLearning.scala</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Background">Background<a class="anchor-link" href="#Background">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Suppose we are building a robot for answering questions in IQ test like this:</p>
<blockquote><p>What is the next number in sequence:</p>
<blockquote><p>3, 6, 9, ?</p>
</blockquote>
<p>The answer is 12.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We prepared some questions and corresponding answers as <a href="https://oss.sonatype.org/service/local/repositories/public/archive/org/nd4j/nd4j-api/0.8.0/nd4j-api-0.8.0-javadoc.jar/!/org/nd4j/linalg/api/ndarray/INDArray.html">INDArray</a>s:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">$ivy.</span><span class="n">`org.nd4j::nd4s:0.8.0`</span><span class="o">,</span> <span class="nc">$ivy</span><span class="o">.</span><span class="n">`org.nd4j:nd4j-native-platform:0.8.0`</span>
<span class="k">import</span> <span class="nn">org.nd4j.linalg.api.ndarray.INDArray</span>

<span class="k">val</span> <span class="nc">TrainingQuestions</span><span class="k">:</span> <span class="kt">INDArray</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">org.nd4s.Implicits._</span>
  <span class="nc">Array</span><span class="o">(</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">10</span><span class="o">),</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">13</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">17</span><span class="o">)</span>
  <span class="o">).</span><span class="n">toNDArray</span>
<span class="o">}</span>

<span class="k">val</span> <span class="nc">ExpectedAnswers</span><span class="k">:</span> <span class="kt">INDArray</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">org.nd4s.Implicits._</span>
  <span class="nc">Array</span><span class="o">(</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">13</span><span class="o">),</span>
    <span class="nc">Array</span><span class="o">(</span><span class="mi">19</span><span class="o">)</span>
  <span class="o">).</span><span class="n">toNDArray</span>
<span class="o">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>SLF4J: Failed to load class &#34;org.slf4j.impl.StaticLoggerBinder&#34;.
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt output_prompt">Out[1]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">$ivy.$                     , $ivy.$                                    
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">org.nd4j.linalg.api.ndarray.INDArray

</span>
<span class="ansi-cyan-fg">TrainingQuestions</span>: <span class="ansi-green-fg">org</span>.<span class="ansi-green-fg">nd4j</span>.<span class="ansi-green-fg">linalg</span>.<span class="ansi-green-fg">api</span>.<span class="ansi-green-fg">ndarray</span>.<span class="ansi-green-fg">INDArray</span> = [[0.00, 1.00, 2.00],
 [4.00, 7.00, 10.00],
 [13.00, 15.00, 17.00]]
<span class="ansi-cyan-fg">ExpectedAnswers</span>: <span class="ansi-green-fg">org</span>.<span class="ansi-green-fg">nd4j</span>.<span class="ansi-green-fg">linalg</span>.<span class="ansi-green-fg">api</span>.<span class="ansi-green-fg">ndarray</span>.<span class="ansi-green-fg">INDArray</span> = [3.00, 13.00, 19.00]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These samples will be used to train the robot.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the rest of this article, we will build the robot in the following steps:</p>
<ol>
<li>Install DeepLearning.scala, which is the framework help us build the robot.</li>
<li>Setup configuration (also known as hyperparameters) of the robot.</li>
<li>Build an untrained neural network of the robot.</li>
<li>Train the neural network using the above samples.</li>
<li>Test the robot seeing if the robot have been learnt how to answer these kind of questions.</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install-DeepLearning.scala">Install DeepLearning.scala<a class="anchor-link" href="#Install-DeepLearning.scala">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>DeepLearning.scala is hosted on Maven Central repository.</p>
<p>You can use magic imports in <a href="https://github.com/alexarchambault/jupyter-scala">jupyter-scala</a> or <a href="http://www.lihaoyi.com/Ammonite/#Ammonite-REPL">Ammonite-REPL</a> to download DeepLearning.scala and its dependencies.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">$ivy.</span><span class="n">`com.thoughtworks.deeplearning::plugins-builtins:2.0.0-RC1`</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[2]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">$ivy.$                                                          </span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you use <a href="http://www.scala-sbt.org">sbt</a>, please add the following settings into your <code>build.sbt</code>:</p>
<div class="highlight"><pre><span></span><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;com.thoughtworks.deeplearning&quot;</span> <span class="o">%%</span> <span class="s">&quot;plugins-builtins&quot;</span> <span class="o">%</span> <span class="s">&quot;latest.release&quot;</span>

<span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;org.nd4j&quot;</span> <span class="o">%%</span> <span class="s">&quot;nd4j-native-platform&quot;</span> <span class="o">%</span> <span class="s">&quot;0.8.0&quot;</span>

<span class="n">fork</span> <span class="o">:=</span> <span class="kc">true</span>

<span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">&quot;2.11.11&quot;</span>
</pre></div>
<p>Note that this example must run on Scala 2.11.11 because <a href="http://nd4j.org/scala">nd4s</a> does not support Scala 2.12. Make sure there is not a setting like <code>scalaVersion := "2.12.x"</code> in your <code>build.sbt</code>.</p>
<p>See <a href="https://index.scala-lang.org/thoughtworksinc/deeplearning.scala">Scaladex</a> to install DeepLearning.scala in other build tools!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup-hyperparameters">Setup hyperparameters<a class="anchor-link" href="#Setup-hyperparameters">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Hyperparameters are global configurations for a neural network.</p>
<p>For this robot, we want to set its learning rate, which determines how fast the robot change its inner weights.</p>
<p>In DeepLearning.scala, hyperparameters can be introduced by plugins, which is a small piece of code loaded from a URL.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">val</span> <span class="nc">INDArrayLearningRatePluginUrl</span> <span class="k">=</span> <span class="s">&quot;https://gist.githubusercontent.com/Atry/1fb0608c655e3233e68b27ba99515f16/raw/27c7d00dd37785335b6acfe1f1c5614843bc6d9f/INDArrayLearningRate.sc&quot;</span>
<span class="n">interp</span><span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="n">scala</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">Source</span><span class="o">.</span><span class="n">fromURL</span><span class="o">(</span><span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="nc">URL</span><span class="o">(</span><span class="nc">INDArrayLearningRatePluginUrl</span><span class="o">)).</span><span class="n">mkString</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">INDArrayLearningRatePluginUrl</span>: <span class="ansi-green-fg">String</span> = <span class="ansi-green-fg">&#34;https://gist.githubusercontent.com/Atry/1fb0608c655e3233e68b27ba99515f16/raw/27c7d00dd37785335b6acfe1f1c5614843bc6d9f/INDArrayLearningRate.sc&#34;</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>By loading the hyperparameter plugin <code>INDArrayLearningRate</code>, we are able to create the context of neural network with <code>learningRate</code> parameter.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">com.thoughtworks.deeplearning.plugins.Builtins</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">com.thoughtworks.deeplearning.plugins.Builtins</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All DeepLearning.scala built-in features are also provided by plugins. <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/plugins/Builtins.html">Builtins</a> is the plugin that contains all other DeepLearning.scala built-in plugins.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we create the context and setup learning rate to <code>0.001</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="c1">// `interp.load` is a workaround for https://github.com/lihaoyi/Ammonite/issues/649 and https://github.com/scala/bug/issues/10390</span>
<span class="n">interp</span><span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">  import scala.concurrent.ExecutionContext.Implicits.global</span>
<span class="s">  import com.thoughtworks.feature.Factory</span>
<span class="s">  val hyperparameters = Factory[Builtins with INDArrayLearningRate].newInstance(learningRate = 0.001)</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>See <a href="https://javadoc.io/page/com.thoughtworks.feature/factory_2.11/latest/com/thoughtworks/feature/Factory.html">Factory</a> if you are wondering how those plugins are composed together.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>Builtins</code> plugin contains some implicit values and views, which should be imported as following:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">hyperparameters.implicits._</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">hyperparameters.implicits._</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Build-an-untrained-neural-network-of-the-robot">Build an untrained neural network of the robot<a class="anchor-link" href="#Build-an-untrained-neural-network-of-the-robot">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In DeepLearning.scala, a neural network is simply a function that references some <strong>weights</strong>, which are mutable variables being changed automatically according to some goals during training.</p>
<p>For example, given <code>x0</code>, <code>x1</code> and <code>x2</code> are the input sequence passed to the robot, we can build a function that returns the answer as <code>robotWeight0 * x0 + robotWeight1 * x1 + robotWeight2 * x2</code>, by adjusting those weightsduring training, the result should become close to the expected answer.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In DeepLearning.scala, weights can be created as following:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">def</span> <span class="n">initialValueOfRobotWeight</span><span class="k">:</span> <span class="kt">INDArray</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">org.nd4j.linalg.factory.Nd4j</span>
  <span class="k">import</span> <span class="nn">org.nd4s.Implicits._</span>
  <span class="nc">Nd4j</span><span class="o">.</span><span class="n">randn</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">import</span> <span class="nn">hyperparameters.INDArrayWeight</span>
<span class="k">val</span> <span class="n">robotWeight</span> <span class="k">=</span> <span class="nc">INDArrayWeight</span><span class="o">(</span><span class="n">initialValueOfRobotWeight</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>defined <span class="ansi-green-fg">function</span> <span class="ansi-cyan-fg">initialValueOfRobotWeight</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">hyperparameters.INDArrayWeight
</span>
<span class="ansi-cyan-fg">robotWeight</span>: <span class="ansi-green-fg">Object</span> with <span class="ansi-green-fg">hyperparameters</span>.<span class="ansi-green-fg">INDArrayWeightApi</span> with <span class="ansi-green-fg">hyperparameters</span>.<span class="ansi-green-fg">WeightApi</span> with <span class="ansi-green-fg">hyperparameters</span>.<span class="ansi-green-fg">WeightApi</span> = $sess.cmd6Wrapper$Helper$Anonymous$macro$1$1$Anonymous$macro$104$1@3c5c4e77</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the above code, <code>robotWeight</code> is a weight of n-dimensional array, say, <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/plugins/INDArrayWeights$INDArrayWeight.html">INDArrayWeight</a>, initialized from random values. Therefore, the formula <code>robotWeight0 * x0 + robotWeight1 * x1 + robotWeight2 * x2</code> can be equivalent to a matrix multipication, written as a <code>dot</code> method call:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">hyperparameters.INDArrayLayer</span>
<span class="k">def</span> <span class="n">iqTestRobot</span><span class="o">(</span><span class="n">questions</span><span class="k">:</span> <span class="kt">INDArray</span><span class="o">)</span><span class="k">:</span> <span class="kt">INDArrayLayer</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">questions</span> <span class="n">dot</span> <span class="n">robotWeight</span>
<span class="o">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[10]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">hyperparameters.INDArrayLayer
</span>
defined <span class="ansi-green-fg">function</span> <span class="ansi-cyan-fg">iqTestRobot</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that the <code>dot</code> method is a differentiable function provided by DeepLearning.scala.
You can find other <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/plugins/RawINDArrayLayers$ImplicitsApi$INDArrayLayerOps.html">n-dimensional array differentiable methods in Scaladoc</a></p>
<p>Unlike the functions in nd4s, all those differentiable functions accepts either an <code>INDArray</code>, <code>INDArrayWeight</code> 
or <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/plugins/RawINDArrayLayers$INDArrayLayer.html">INDArrayLayer</a>, and returns one <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/plugins/Layers$Layer.html">Layer</a> of neural network, which can be composed into another differentiable function call.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Training-the-network">Training the network<a class="anchor-link" href="#Training-the-network">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Loss-function">Loss function<a class="anchor-link" href="#Loss-function">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In DeepLearning.scala, when we train a neural network, our goal should always be minimizing the return value.</p>
<p>For example, if <code>iqTestRobot(TrainingQuestions).train</code> get called repeatedly,
the neural network would try to minimize <code>input dot robotWeight</code>.
<code>robotWeight</code> would become smaller and smaller in order to make <code>input dot robotWeight</code> smaller,
and <code>iqTestRobot(TrainingQuestions).predict</code> would return an <code>INDArray</code> of small numbers.</p>
<p>What if you expect <code>iqTestRobot(TrainingQuestions).predict</code> to return <code>ExpectedAnswers</code>?</p>
<p>You can create another neural network that evaluates how far between the result of <code>myNeuralNetwork</code> and your expectation. The new neural network is usually called <strong>loss function</strong>.</p>
<p>In this article we will use square loss as the loss function:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">hyperparameters.DoubleLayer</span>
<span class="k">def</span> <span class="n">squareLoss</span><span class="o">(</span><span class="n">questions</span><span class="k">:</span> <span class="kt">INDArray</span><span class="o">,</span> <span class="n">expectAnswer</span><span class="k">:</span> <span class="kt">INDArray</span><span class="o">)</span><span class="k">:</span> <span class="kt">DoubleLayer</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">difference</span> <span class="k">=</span> <span class="n">iqTestRobot</span><span class="o">(</span><span class="n">questions</span><span class="o">)</span> <span class="o">-</span> <span class="n">expectAnswer</span>
  <span class="o">(</span><span class="n">difference</span> <span class="o">*</span> <span class="n">difference</span><span class="o">).</span><span class="n">sum</span>
<span class="o">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">hyperparameters.DoubleLayer
</span>
defined <span class="ansi-green-fg">function</span> <span class="ansi-cyan-fg">squareLoss</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When the <code>lossFunction</code> get trained continuously, its return value will be close to zero, and the result of  <code>myNeuralNetwork</code> must be close to the expected result at the same time.</p>
<p>Note the <code>lossFunction</code> accepts a <code>questions</code> and <code>expectAnswer</code> as its parameter.
The first parameter is the input data used to train the neural network, and the second array is the expected output.</p>
<p>The <code>squareLoss</code> function itself is a neural network, internally using the layer returned by <code>iqTestRobot</code> method.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Run-the-training-task">Run the training task<a class="anchor-link" href="#Run-the-training-task">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As I mentioned before, there is a <a href="https://javadoc.io/page/com.thoughtworks.deeplearning/plugins-builtins_2.11/latest/com/thoughtworks/deeplearning/DeepLearning$$Ops.html#train(implicitmonoid:spire.algebra.MultiplicativeMonoid[Ops.this.typeClassInstance.Delta]):scalaz.concurrent.Task[Ops.this.typeClassInstance.Data]">train</a> method for <code>DoubleLayer</code>. It is a <a href="https://javadoc.io/page/org.scalaz/scalaz-concurrent_2.11/latest/scalaz/concurrent/Task.html">Task</a> that performs one iteration of training.</p>
<p>Since we want to repeatedly train the neural network of the robot, we need to create another <code>Task</code> that performs many iterations of training.</p>
<p>In this article, we use <a href="https://github.com/ThoughtWorksInc/each">ThoughtWorks Each</a> to build such a <code>Task</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">$ivy.</span><span class="n">`com.thoughtworks.each::each:3.3.1`</span>
<span class="k">import</span> <span class="nn">$plugin.$ivy.</span><span class="n">`org.scalamacros:paradise_2.11.11:2.1.0`</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">$ivy.$                                  
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">$plugin.$                                            </span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">com.thoughtworks.each.Monadic._</span>
<span class="k">import</span> <span class="nn">scalaz.concurrent.Task</span>
<span class="k">import</span> <span class="nn">scalaz.std.stream._</span>

<span class="k">val</span> <span class="nc">TotalIterations</span> <span class="k">=</span> <span class="mi">500</span>

<span class="nd">@monadic</span><span class="o">[</span><span class="kt">Task</span><span class="o">]</span>
<span class="k">def</span> <span class="n">train</span><span class="k">:</span> <span class="kt">Task</span><span class="o">[</span><span class="kt">Stream</span><span class="o">[</span><span class="kt">Double</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">iteration</span> <span class="k">&lt;-</span> <span class="o">(</span><span class="mi">0</span> <span class="n">until</span> <span class="nc">TotalIterations</span><span class="o">).</span><span class="n">toStream</span><span class="o">)</span> <span class="k">yield</span> <span class="o">{</span>
    <span class="n">squareLoss</span><span class="o">(</span><span class="nc">TrainingQuestions</span><span class="o">,</span> <span class="nc">ExpectedAnswers</span><span class="o">).</span><span class="n">train</span><span class="o">.</span><span class="n">each</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">com.thoughtworks.each.Monadic._
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">scalaz.concurrent.Task
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">scalaz.std.stream._

</span>
<span class="ansi-cyan-fg">TotalIterations</span>: <span class="ansi-green-fg">Int</span> = <span class="ansi-green-fg">500</span>
defined <span class="ansi-green-fg">function</span> <span class="ansi-cyan-fg">train</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we can run the task to train the robot.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">val</span> <span class="n">lossByTime</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="n">train</span><span class="o">.</span><span class="n">unsafePerformSync</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[14]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">lossByTime</span>: <span class="ansi-green-fg">Stream</span>[<span class="ansi-green-fg">Double</span>] = <span class="ansi-yellow-fg">Stream</span>(
  <span class="ansi-green-fg">26.527782440185547</span>,
  <span class="ansi-green-fg">14.541202545166016</span>,
  <span class="ansi-green-fg">8.776931762695312</span>,
  <span class="ansi-green-fg">5.974719524383545</span>,
  <span class="ansi-green-fg">4.583561420440674</span>,
  <span class="ansi-green-fg">3.8655362129211426</span>,
  <span class="ansi-green-fg">3.4695513248443604</span>,
  <span class="ansi-green-fg">3.228524684906006</span>,
  <span class="ansi-green-fg">3.0629053115844727</span>,
  <span class="ansi-green-fg">2.934811592102051</span>,
  <span class="ansi-green-fg">2.8261594772338867</span>,
<span class="ansi-yellow-fg">...</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we create a plot to show how the loss changed during iterations.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">import</span> <span class="nn">$ivy.</span><span class="n">`org.plotly-scala::plotly-jupyter-scala:0.3.2`</span>

<span class="k">import</span> <span class="nn">plotly._</span>
<span class="k">import</span> <span class="nn">plotly.element._</span>
<span class="k">import</span> <span class="nn">plotly.layout._</span>
<span class="k">import</span> <span class="nn">plotly.JupyterScala._</span>

<span class="n">plotly</span><span class="o">.</span><span class="nc">JupyterScala</span><span class="o">.</span><span class="n">init</span><span class="o">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">

      <script type="text/javascript">
        require.config({
  paths: {
    d3: 'https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min',
    plotly: 'https://cdn.plot.ly/plotly-1.12.0.min'
  },

  shim: {
    plotly: {
      deps: ['d3', 'jquery'],
      exports: 'plotly'
    }
  }
});
        

        require(['plotly'], function(Plotly) {
          window.Plotly = Plotly;
        });
      </script>
    
</div>

</div>

<div class="output_area">

<div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">$ivy.$                                             

</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">plotly._
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">plotly.element._
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">plotly.layout._
</span>
<span class="ansi-green-fg">import </span><span class="ansi-cyan-fg">plotly.JupyterScala._

</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="nc">Scatter</span><span class="o">(</span><span class="n">lossByTime</span><span class="o">.</span><span class="n">indices</span><span class="o">,</span> <span class="n">lossByTime</span><span class="o">).</span><span class="n">plot</span><span class="o">(</span><span class="n">title</span> <span class="k">=</span> <span class="s">&quot;loss by time&quot;</span><span class="o">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<div class="chart" id="plot-1332335910"></div>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>





<div id="8265ba44-0e66-45b3-9ec8-21ed79e837b5"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8265ba44-0e66-45b3-9ec8-21ed79e837b5');
requirejs(["plotly"], function(Plotly) {
  (function () {
  var data0 = {"type":"scatter","x":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0,20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0,52.0,53.0,54.0,55.0,56.0,57.0,58.0,59.0,60.0,61.0,62.0,63.0,64.0,65.0,66.0,67.0,68.0,69.0,70.0,71.0,72.0,73.0,74.0,75.0,76.0,77.0,78.0,79.0,80.0,81.0,82.0,83.0,84.0,85.0,86.0,87.0,88.0,89.0,90.0,91.0,92.0,93.0,94.0,95.0,96.0,97.0,98.0,99.0,100.0,101.0,102.0,103.0,104.0,105.0,106.0,107.0,108.0,109.0,110.0,111.0,112.0,113.0,114.0,115.0,116.0,117.0,118.0,119.0,120.0,121.0,122.0,123.0,124.0,125.0,126.0,127.0,128.0,129.0,130.0,131.0,132.0,133.0,134.0,135.0,136.0,137.0,138.0,139.0,140.0,141.0,142.0,143.0,144.0,145.0,146.0,147.0,148.0,149.0,150.0,151.0,152.0,153.0,154.0,155.0,156.0,157.0,158.0,159.0,160.0,161.0,162.0,163.0,164.0,165.0,166.0,167.0,168.0,169.0,170.0,171.0,172.0,173.0,174.0,175.0,176.0,177.0,178.0,179.0,180.0,181.0,182.0,183.0,184.0,185.0,186.0,187.0,188.0,189.0,190.0,191.0,192.0,193.0,194.0,195.0,196.0,197.0,198.0,199.0,200.0,201.0,202.0,203.0,204.0,205.0,206.0,207.0,208.0,209.0,210.0,211.0,212.0,213.0,214.0,215.0,216.0,217.0,218.0,219.0,220.0,221.0,222.0,223.0,224.0,225.0,226.0,227.0,228.0,229.0,230.0,231.0,232.0,233.0,234.0,235.0,236.0,237.0,238.0,239.0,240.0,241.0,242.0,243.0,244.0,245.0,246.0,247.0,248.0,249.0,250.0,251.0,252.0,253.0,254.0,255.0,256.0,257.0,258.0,259.0,260.0,261.0,262.0,263.0,264.0,265.0,266.0,267.0,268.0,269.0,270.0,271.0,272.0,273.0,274.0,275.0,276.0,277.0,278.0,279.0,280.0,281.0,282.0,283.0,284.0,285.0,286.0,287.0,288.0,289.0,290.0,291.0,292.0,293.0,294.0,295.0,296.0,297.0,298.0,299.0,300.0,301.0,302.0,303.0,304.0,305.0,306.0,307.0,308.0,309.0,310.0,311.0,312.0,313.0,314.0,315.0,316.0,317.0,318.0,319.0,320.0,321.0,322.0,323.0,324.0,325.0,326.0,327.0,328.0,329.0,330.0,331.0,332.0,333.0,334.0,335.0,336.0,337.0,338.0,339.0,340.0,341.0,342.0,343.0,344.0,345.0,346.0,347.0,348.0,349.0,350.0,351.0,352.0,353.0,354.0,355.0,356.0,357.0,358.0,359.0,360.0,361.0,362.0,363.0,364.0,365.0,366.0,367.0,368.0,369.0,370.0,371.0,372.0,373.0,374.0,375.0,376.0,377.0,378.0,379.0,380.0,381.0,382.0,383.0,384.0,385.0,386.0,387.0,388.0,389.0,390.0,391.0,392.0,393.0,394.0,395.0,396.0,397.0,398.0,399.0,400.0,401.0,402.0,403.0,404.0,405.0,406.0,407.0,408.0,409.0,410.0,411.0,412.0,413.0,414.0,415.0,416.0,417.0,418.0,419.0,420.0,421.0,422.0,423.0,424.0,425.0,426.0,427.0,428.0,429.0,430.0,431.0,432.0,433.0,434.0,435.0,436.0,437.0,438.0,439.0,440.0,441.0,442.0,443.0,444.0,445.0,446.0,447.0,448.0,449.0,450.0,451.0,452.0,453.0,454.0,455.0,456.0,457.0,458.0,459.0,460.0,461.0,462.0,463.0,464.0,465.0,466.0,467.0,468.0,469.0,470.0,471.0,472.0,473.0,474.0,475.0,476.0,477.0,478.0,479.0,480.0,481.0,482.0,483.0,484.0,485.0,486.0,487.0,488.0,489.0,490.0,491.0,492.0,493.0,494.0,495.0,496.0,497.0,498.0,499.0],"y":[26.527782440185547,14.541202545166016,8.776931762695312,5.974719524383545,4.583561420440674,3.8655362129211426,3.4695513248443604,3.228524684906006,3.0629053115844727,2.934811592102051,2.8261594772338867,2.728300094604492,2.6370606422424316,2.5504119396209717,2.467353582382202,2.387346029281616,2.3100976943969727,2.2354283332824707,2.163212776184082,2.0933451652526855,2.025747537612915,1.9603288173675537,1.8970272541046143,1.8357762098312378,1.7764979600906372,1.719135046005249,1.663625717163086,1.6099108457565308,1.557921290397644,1.5076203346252441,1.4589388370513916,1.4118298292160034,1.366245150566101,1.3221290111541748,1.27943754196167,1.2381247282028198,1.198146104812622,1.1594605445861816,1.1220210790634155,1.0857900381088257,1.0507307052612305,1.0168049335479736,0.983972430229187,0.9521991014480591,0.9214550256729126,0.8916990160942078,0.8629069924354553,0.835044264793396,0.8080828189849854,0.7819899320602417,0.7567402124404907,0.7323057055473328,0.7086602449417114,0.6857768297195435,0.6636322140693665,0.6422037482261658,0.6214681267738342,0.6014026403427124,0.5819829106330872,0.5631912350654602,0.5450044870376587,0.5274072885513306,0.5103778839111328,0.49389803409576416,0.4779496490955353,0.46251797676086426,0.4475823640823364,0.4331321120262146,0.4191446602344513,0.40561115741729736,0.39251312613487244,0.37984034419059753,0.3675750494003296,0.35570621490478516,0.34422066807746887,0.3331059217453003,0.3223498463630676,0.31194132566452026,0.30186906456947327,0.2921227216720581,0.28269124031066895,0.2735617756843567,0.2647273540496826,0.25618064403533936,0.24790844321250916,0.23990383744239807,0.23215627670288086,0.22466054558753967,0.21740661561489105,0.21038676798343658,0.20359361171722412,0.1970193237066269,0.19065821170806885,0.1845027357339859,0.17854443192481995,0.17277942597866058,0.16719965636730194,0.16180092096328735,0.1565762311220169,0.1515209972858429,0.1466284841299057,0.1418934017419815,0.13731224834918976,0.13287878036499023,0.12858743965625763,0.12443596124649048,0.12041832506656647,0.11652957648038864,0.11276635527610779,0.10912661254405975,0.10560192912817001,0.1021919995546341,0.09889236092567444,0.09569962322711945,0.0926097184419632,0.08961891382932663,0.08672527968883514,0.08392450213432312,0.08121460676193237,0.07859283685684204,0.07605475932359695,0.07359857112169266,0.07122278213500977,0.06892270594835281,0.06669767200946808,0.06454408913850784,0.06245988607406616,0.06044270843267441,0.05849139764904976,0.05660262331366539,0.05477453023195267,0.053006574511528015,0.05129475146532059,0.049638308584690094,0.04803621023893356,0.046484626829624176,0.04498397558927536,0.04353100806474686,0.042125679552555084,0.040765345096588135,0.03944932669401169,0.03817508742213249,0.03694232553243637,0.03574983775615692,0.0345955453813076,0.03347800672054291,0.03239737078547478,0.03135102614760399,0.030338943004608154,0.02935941144824028,0.02841133251786232,0.027493897825479507,0.026606064289808273,0.025746818631887436,0.024915674701333046,0.024110998958349228,0.023332729935646057,0.022579068318009377,0.021850083023309708,0.021144455298781395,0.020462000742554665,0.01980128325521946,0.01916191726922989,0.018542973324656487,0.017944350838661194,0.017364639788866043,0.016804473474621773,0.01626160740852356,0.015736542642116547,0.0152283338829875,0.014736756682395935,0.014260667376220226,0.013800367712974548,0.013354937545955181,0.012923616915941238,0.012506229802966118,0.012102596461772919,0.01171167753636837,0.011333659291267395,0.01096752192825079,0.010613484308123589,0.010270568542182446,0.0099391620606184,0.009618169628083706,0.00930775422602892,0.009007235988974571,0.00871632993221283,0.008434795774519444,0.008162581361830235,0.00789868924766779,0.007643766235560179,0.0073970407247543335,0.007158167194575071,0.006927162874490023,0.0067033786326646805,0.006486959755420685,0.006277496926486492,0.006074785254895687,0.0058785672299563885,0.005688880104571581,0.005504993721842766,0.005327440332621336,0.0051553924567997456,0.0049888938665390015,0.004827742464840412,0.004671751521527767,0.004520951770246029,0.0043750642798841,0.004233874846249819,0.004097045864909887,0.003964894451200962,0.003836681367829442,0.00371280568651855,0.0035929556470364332,0.00347704766318202,0.00336478091776371,0.0032560513354837894,0.0031508796382695436,0.0030492600053548813,0.0029508250299841166,0.002855433151125908,0.002763244556263089,0.0026740115135908127,0.0025877279695123434,0.0025041906628757715,0.0024233877193182707,0.0023450045846402645,0.002269310411065817,0.002196080284193158,0.002125239698216319,0.0020565122831612825,0.0019901336636394262,0.0019259126856923103,0.0018637127941474319,0.0018034859094768763,0.0017453143373131752,0.0016889490652829409,0.0016344700707122684,0.0015816548839211464,0.0015304964035749435,0.0014811562141403556,0.001433289609849453,0.0013870183611288667,0.0013422047486528754,0.0012989029055461287,0.0012569297105073929,0.0012163991341367364,0.0011770714772865176,0.0011390645522624254,0.0011022994294762611,0.001066682394593954,0.001032300409860909,9.989561513066292E-4,9.666395490057766E-4,9.354577632620931E-4,9.052425739355385E-4,8.76063306350261E-4,8.477519731968641E-4,8.203799952752888E-4,7.938345661386847E-4,7.682277355343103E-4,7.43402517400682E-4,7.194240461103618E-4,6.962314364500344E-4,6.736775976605713E-4,6.519511225633323E-4,6.309141172096133E-4,6.105020875111222E-4,5.908237071707845E-4,5.717402673326433E-4,5.532687064260244E-4,5.354119930416346E-4,5.181723972782493E-4,5.014007911086082E-4,4.8518041148781776E-4,4.695439711213112E-4,4.544024122878909E-4,4.396777367219329E-4,4.255214589647949E-4,4.117652715649456E-4,3.9845239371061325E-4,3.856064868159592E-4,3.731875913217664E-4,3.6112358793616295E-4,3.494276315905154E-4,3.381601709406823E-4,3.2726855715736747E-4,3.166730748489499E-4,3.06468631606549E-4,2.9653660021722317E-4,2.8697995003312826E-4,2.777066547423601E-4,2.6873545721173286E-4,2.600664447527379E-4,2.516796230338514E-4,2.435276546748355E-4,2.3567221069242805E-4,2.280613116454333E-4,2.2066231758799404E-4,2.1356351498980075E-4,2.0664722251240164E-4,1.9996879564132541E-4,1.9354901451151818E-4,1.872954744612798E-4,1.8126268696505576E-4,1.7538739484734833E-4,1.69702063431032E-4,1.6422776388935745E-4,1.589333696756512E-4,1.5379996330011636E-4,1.4883812400512397E-4,1.4402646047528833E-4,1.393812708556652E-4,1.3489687989931554E-4,1.3053062139078975E-4,1.263180747628212E-4,1.222201099153608E-4,1.182668493129313E-4,1.1447381984908134E-4,1.1078524403274059E-4,1.0718296107370406E-4,1.0372696124250069E-4,1.0036695312010124E-4,9.715057967696339E-5,9.400839917361736E-5,9.095527639146894E-5,8.804886601865292E-5,8.518289541825652E-5,8.242641342803836E-5,7.978036592248827E-5,7.721083966316655E-5,7.471733260899782E-5,7.228330650832504E-5,6.996136653469875E-5,6.77096686558798E-5,6.55114054097794E-5,6.339457468129694E-5,6.134128489065915E-5,5.937448440818116E-5,5.745823364122771E-5,5.559982673730701E-5,5.3800791647518054E-5,5.20802459504921E-5,5.038202289142646E-5,4.8769667046144605E-5,4.7187888412736356E-5,4.565612834994681E-5,4.418690150487237E-5,4.2754334572236985E-5,4.137899668421596E-5,4.0048984374152496E-5,3.875547554343939E-5,3.7504141801036894E-5,3.629547791206278E-5,3.51283852069173E-5,3.3974611142184585E-5,3.2896423363126814E-5,3.183042645105161E-5,3.0799910746281967E-5,2.9798959076288156E-5,2.8834270779043436E-5,2.7903191949008033E-5,2.7006484742742032E-5,2.613429751363583E-5,2.5295214072684757E-5,2.4479377316311002E-5,2.368693458265625E-5,2.29241959459614E-5,2.2175452613737434E-5,2.146243605238851E-5,2.0763694919878617E-5,2.010575008171145E-5,1.9448058083071373E-5,1.8820370314642787E-5,1.822030208131764E-5,1.763727777870372E-5,1.7051681425073184E-5,1.6502726793987677E-5,1.5971238099155016E-5,1.5462144801858813E-5,1.4962037312216125E-5,1.4483395716524683E-5,1.4013721738592722E-5,1.3552962627727538E-5,1.3124206816428341E-5,1.2697497368208133E-5,1.2278262147447094E-5,1.1889662346220575E-5,1.1502479537739418E-5,1.1132893632748164E-5,1.0776108865684364E-5,1.0425121217849664E-5,1.0086486327054445E-5,9.763933121575974E-6,9.452560334466398E-6,9.141738701146096E-6,8.85144982021302E-6,8.561321919842158E-6,8.294808139908127E-6,8.020758286875207E-6,7.754695616313256E-6,7.512246156693436E-6,7.265612111950759E-6,7.02787747286493E-6,6.807077625126112E-6,6.585972187167499E-6,6.3688389673188794E-6,6.164304068079218E-6,5.963118383078836E-6,5.7734760048333555E-6,5.584135578828864E-6,5.412082828115672E-6,5.229680482443655E-6,5.064068773208419E-6,4.9021109589375556E-6,4.743193585454719E-6,4.5870365283917636E-6,4.440695192897692E-6,4.2969918467861135E-6,4.162630375503795E-6,4.020932465209626E-6,3.894546352967154E-6,3.7709201023972128E-6,3.649047584985965E-6,3.5325695080246078E-6,3.4154691093135625E-6,3.3000924304360524E-6,3.199051207047887E-6,3.093891791650094E-6,2.9903771974204574E-6,2.8948738872713875E-6,2.8010408641421236E-6,2.716415110626258E-6,2.6260306640324416E-6,2.5394547265022993E-6,2.4572630081820535E-6,2.379111720074434E-6,2.302315124325105E-6,2.2293816073215567E-6,2.155716401830432E-6,2.0873130779364146E-6,2.0209977265039925E-6,1.9532280930434354E-6,1.8912326140707592E-6,1.830322617024649E-6,1.7703246157907415E-6,1.7118336472776718E-6,1.660557245486416E-6,1.6042445167840924E-6,1.554554046379053E-6,1.5063969840412028E-6,1.4565030141966417E-6,1.4098327483225148E-6,1.3600651982415002E-6,1.3171234058972914E-6,1.276482635148568E-6,1.2366199371172115E-6,1.1958900358877145E-6,1.1574506970646325E-6,1.1181330137333134E-6,1.081171831174288E-6,1.0465464583830908E-6,1.0128662779607112E-6,9.81024868451641E-7,9.483661074227712E-7,9.193536811835656E-7,8.878642461240815E-7,8.598595400144404E-7,8.310607881867327E-7,8.056022124947049E-7,7.806470989635272E-7,7.54722350393422E-7,7.292928785318509E-7,7.070189553814998E-7,6.825840159763175E-7,6.610389959860186E-7,6.387529083440313E-7,6.192845489749743E-7,5.990769409436325E-7,5.804204761261644E-7,5.621552645607153E-7,5.440997483674437E-7,5.265158051770413E-7,5.090259946882725E-7,4.909782091999659E-7,4.753738380713912E-7,4.602089234140294E-7,4.4506396079668775E-7,4.315306796343066E-7,4.170061060904118E-7,4.029762408208626E-7,3.9100092408261844E-7,3.7733957469754387E-7,3.6583475093721063E-7,3.5373665241422714E-7,3.426708303777559E-7,3.318205585856049E-7,3.2125194593390916E-7,3.1169116709861555E-7,3.005653184118273E-7]};

  var data = [data0];
  var layout = {"title":"loss by time"};

  Plotly.plot('plot-1332335910', data, layout);
})();
});
      
</script>
</div>

</div>

<div class="output_area">

<div class="prompt output_prompt">Out[22]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">res21</span>: <span class="ansi-green-fg">String</span> = <span class="ansi-green-fg">&#34;plot-1332335910&#34;</span></pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>After those iterations, the loss should close to zero.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test-the-trained-robot">Test the trained robot<a class="anchor-link" href="#Test-the-trained-robot">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">val</span> <span class="nc">TestQuestions</span><span class="k">:</span> <span class="kt">INDArray</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">org.nd4s.Implicits._</span>
  <span class="nc">Array</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">9</span><span class="o">)).</span><span class="n">toNDArray</span>
<span class="o">}</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">TestQuestions</span>: <span class="ansi-green-fg">INDArray</span> = [3.00, 6.00, 9.00]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="n">iqTestRobot</span><span class="o">(</span><span class="nc">TestQuestions</span><span class="o">).</span><span class="n">predict</span><span class="o">.</span><span class="n">unsafePerformSync</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[18]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">res17</span>: <span class="ansi-green-fg">INDArray</span> = 12.00</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The result should close to <code>12</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You may also see the value of weights in the trained neural network:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-scala"><pre><span></span><span class="k">val</span> <span class="n">weightData</span><span class="k">:</span> <span class="kt">INDArray</span> <span class="o">=</span> <span class="n">robotWeight</span><span class="o">.</span><span class="n">data</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[21]:</div>




<div class="output_text output_subarea output_execute_result">
<pre><span class="ansi-cyan-fg">weightData</span>: <span class="ansi-green-fg">INDArray</span> = [-0.52, 0.03, 1.48]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Conclusion">Conclusion<a class="anchor-link" href="#Conclusion">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this article, we have created a IQ test robot with the help of DeepLearning.scala.</p>
<p>The model of robot is linear regression with a square loss, which consists of some <code>INDArryWeight</code>s and <code>INDArrayLayer</code>s.</p>
<p>After many iterations of <code>train</code>ing, the robot finally learnt the pattern of arithmetic progression.</p>

</div>
</div>
</div>
 

